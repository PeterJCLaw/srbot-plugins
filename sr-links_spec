#!/usr/bin/env rspec

require './test_mocks.rb'

require './sr-links.rb'

describe SRLinksPlugin, "#listen" do

  [
  "#123",
  "things #123",
  "#123 here",
  "things #123 here"
  ].each do |text|
    it "should find trac number 123 when listening to '#{text}'." do
      msg = TestableMessage.new
      msg.message = text
      plugin = SRLinksPlugin.new
      plugin.listen(msg)
      msg.get_replies.should eq("http://trac.srobo.org/ticket/123\n")
    end
  end

  [
  "things not 123 here",
  "things not #0147here either",
  "things not #here either",
  "#here"
  ].each do |text|
    it "shouldn't find a trac number when listening to '#{text}'." do
      msg = TestableMessage.new
      msg.message = text
      plugin = SRLinksPlugin.new
      plugin.listen(msg)
      msg.get_replies.should eq("")
    end
  end

  [
  "trac 123",
  "trac #123",
  "trac things #123",
  "trac #123 here",
  "trac things #123 here"
  ].each do |text|
    it "should find trac number 123 when directly messaged '#{text}'." do
      msg = TestableMessage.new
      msg.message = text
      plugin = SRLinksPlugin.new
      plugin.privmsg(msg)
      msg.get_replies.should eq("http://trac.srobo.org/ticket/123\n")
    end
  end

  Hash[
  "trac PageName" => "PageName",
  "trac Spacey Page Name" => "Spacey%20Page%20Name"
  ].each {|text, page|
    it "should link a trac page when directly messaged '#{text}'." do
      msg = TestableMessage.new
      msg.message = text
      plugin = SRLinksPlugin.new
      plugin.privmsg(msg)
      msg.get_replies.should eq("http://trac.srobo.org/wiki/#{page}\n")
    end
  }

end
